<!doctype html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width,initial-scale=1'>
    <meta name="generator" content="Hugo 0.72.0" />
    <title>Bit by bit</title>
    <link rel='stylesheet' href='/css/styles.css'>
  </head>
  <body>
    <header>
      
  <h3>/ <a href='/'>Bit by bit</a>
  
    
      / <a href='../'>posts</a>
    
  
</a></h3>


    </header>

    <main>
      
  <h1>SQLite: show UTC timestamp as local time</h1>
  
    Jun 24, 2019
  
  
    <nav class='tags'>
      <ul class='tags'>
        <li><a href='https://shaolang.github.io/tags/sqlite3/'>sqlite3</a></li>
      </ul>
    </nav>
  
  <article>
    <p>A business unit asked me to compile some trading volume stats by trading hour.
The good thing is that I have the following in SQLite database; the bad thing
is the database stores the timestamp as follows:</p>
<!-- raw HTML omitted -->
<p><code>timestamp</code> column is stored as a string<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>, so rather than doing timezone
arithmetic, I used SQLite&rsquo;s built-in date/time functions instead:</p>
<pre><code>WITH
epochized AS (
    SELECT STRFTIME('%s', [timestamp]) AS [epoch]    -- convert to unix epoch
    FROM trades),
localized AS (
    SELECT TIME([epoch], 'unixepoch', 'localtime')  -- convert epoch to local time
    FROM dropped_offsets),
SELECT SUBSTR([localtime], 1, 2) AS [trading_hour]  -- extract hour
FROM localized;
</code></pre><p><em>The above employs <a href="https://en.wikipedia.org/wiki/Hierarchical_and_recursive_queries_in_SQL#Common_table_expression">common table expressions</a> for clarity; the actual
combined them as one instead.</em></p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>Okay, to be fair, SQLite employs what it terms as <a href="https://sqlite.org/datatype3.html#type_affinity">type affinity</a> <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>

  </article>

    </main>

    
<section id='comments'>
  <script src="https://utteranc.es/client.js"
          repo="shaolang/shaolang.github.io"
          issue-term="pathname"
          label="blogcomment"
          theme="github-light"
          crossorigin="anonymous"
          async>
  </script>
</section>


    <footer>
      
        <nav class='social'>
          
            <a href='https://github.com/shaolang'><img src='/images/github.png' /></a>
          
            <a href='https://www.linkedin.com/in/shaolang'><img src='/images/linkedin.png' /></a>
          
            <a href='index.xml'><img src='/images/rss.png' /></a>
          
            <a href='https://www.twitter.com/shaolang'><img src='/images/twitter.png' /></a>
          
        </nav>
        <div class='copyright'>&copy; Creative Commons Attribution-ShareAlike 4.0 International</div>
        <div>Generated by <a href='https://gohugo.io'>Hugo 0.72.0</a></div>
      
    </footer>
  </body>
</html>
